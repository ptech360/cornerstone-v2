<div class="existing">
<div class="panel panel-default">
  <div class="panel-body">
    <input class="form-control" *ngIf="selectedStudent==null" type="text" placeholder="Search by Student Name ... " (keyup)="dropdown=false;searchStudents($event)"
      style="display:inline;width:95%">
    <input *ngIf="selectedStudent" class="form-control" type="text" value="{{selectedStudent.name}}" onfocus="this.value= ''"
      (keyup)="dropdown=false;searchStudents($event)" style="display:inline;width:95%">
    <button style="background:none;border:none;outline:none;margin-left: -28px;" (click)="dropdown ? dropdown = false : dropdown = true;selected=false"> <span class="glyphicon glyphicon-chevron-down custom-icon" ></span></button>

    <div class="studentList" *ngIf="(selected)">
      <ul class="list-group">
         <li class="list-group-item" *ngIf="emptySearchResult && !loader">No Data to Display</li> 
        <li class=""><div class="row text-center"><loader [condition]="loader" class="loader"></loader></div></li>
        <span *ngFor="let s of students">
                
               <li class="list-group-item" (click)="addForm=null;getStudentDetails(s.id)"> {{s.name}} </li> 
               </span>
      </ul>
    </div>

    <div class="studentList" *ngIf="(dropdown)">
      <ul class="list-group">
        <span *ngFor="let s of studentsCOPY">
               <li class="list-group-item" (click)="dropdown=false;addForm=null;getStudentDetails(s.id)"> {{s.name}} </li> 
               </span>
      </ul>
    </div>


    <div class="row" *ngIf="selectedStudent">



      <div class="panel-group" id="accordion" *ngIf="selectedStudent" style="margin:5%;">
        <div class="panel panel-default">
          <div class="row text-center"><loader [condition]="loader"></loader></div>
          <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#collapseOne">
            <h4 class="panel-title">
              Student Details
            </h4>
          </div>
          <div id="collapseOne" class="panel-collapse collapse in">
            <div class="panel-body">
              <table class="table col-sm-12">
                <tbody>
                  <tr>
                    <td colspan="3" class="text-center">
                      <img *ngIf="selectedStudent.picTimestamp" [attr.src]="fileUrl+'/' + selectedStudent.picTimestamp" class="profilePic" data-target='#uploadStudentModal'
                        data-toggle='modal' (click)="selectedImageUpload=selectedStudent;uploadPicForm.controls['file'].reset();">
                      <img *ngIf="!selectedStudent.picTimestamp" [attr.src]="fileUrl+'/parent%2f39945169084408330481.jpg?alt=media'" class="profilePic"
                        data-target='#uploadParentModal' data-toggle='modal' (click)="selectedImageUpload=selectedStudent;uploadPicForm.controls['file'].reset();">
                    </td>
                  </tr>

                  <tr>
                    <td>
                      <label for="sname1">Name</label>
                      <p>{{selectedStudent.name}}</p>
                    </td>
                    <td>
                      <label for="stnd1">Standard</label>
                      <p><span *ngFor="let s of standards"><span *ngIf="s.id==selectedStudent.standardId">{{s.name}}</span></span>
                      </p>
                    </td>
                    <td>
                      <button class="btn btn-primary pull-right " data-toggle="modal" data-target="#editSiblingModal" (click)="selectedSibling = selectedStudent;initEditStudentForm()">Edit</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="panel panel-default" *ngIf="selectedStudent.siblings">
          <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#collapseTwo">
            <h4 class="panel-title">
              Add Siblings
            </h4>
          </div>
          <div id="collapseTwo" class="panel-collapse collapse">
            <div class="panel-body">
              <div class="row col-sm-12" *ngIf="selectedStudent.siblings.length==0">
                No Siblings added.
              </div>

              <table class="table col-sm-12">
                <tbody *ngFor="let s of selectedStudent.siblings" style="border:none !important">
                  <tr>
                    <td>
                      <img *ngIf="s.picTimestamp" [attr.src]="fileUrl+'/' + s.picTimestamp" class="profilePic1" data-target='#uploadStudentModal'
                        data-toggle='modal' (click)="selectedImageUpload=s;uploadPicForm.controls['file'].reset();">
                      <img *ngIf="!s.picTimestamp" [attr.src]="fileUrl+'/parent%2f39945169084408330481.jpg?alt=media'" class="profilePic1" data-target='#uploadStudentModal'
                        data-toggle='modal' (click)="selectedImageUpload=s;uploadPicForm.controls['file'].reset();">
                    </td>
                    <td>
                      <label for="sname2">Name</label>
                      <p>{{s.name}}</p>
                    </td>
                    <td>
                      <label for="stnd2">Standard</label>
                      <p><span *ngFor="let p of standards"><span *ngIf="p.id==s.standardId">{{p.name}}</span></span>
                      </p>
                    </td>
                    <td>
                      <button class="btn btn-primary pull-right " data-toggle="modal" data-target="#editSiblingModal" (click)="selectedSibling = s;initEditStudentForm()">Edit</button>
                    </td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#collapseThree">
            <h4 class="panel-title">
              Parent Details
            </h4>
          </div>
          <div id="collapseThree" class="panel-collapse collapse">
            <table class="table col-sm-12">
              <tbody style="border:white 10px solid;background:#fcf9f9" *ngFor="let p of selectedStudent.parents">
                <tr>
                  <td rowspan="2">
                    <img *ngIf="p.picTimestamp" [attr.src]="fileUrl+'/' + p.picTimestamp" class="profilePic1" data-target='#uploadParentModal'
                      (click)="selectedImageUpload=p;uploadPicForm.controls['file'].reset();" data-toggle='modal'>
                    <img *ngIf="!p.picTimestamp" [attr.src]="fileUrl+'/parent%2f39945169084408330481.jpg?alt=media'" class="profilePic1" data-target='#uploadParentModal'
                      (click)="selectedImageUpload=p;uploadPicForm.controls['file'].reset();" data-toggle='modal'>
                  </td>
                  <td>
                    <label for="sname3">Name</label>
                    <span>
            <p *ngIf="(p.name==null)||(p.name=='')">-</p>
            <p *ngIf="p.name!=null">{{p.name}}</p>
            </span>
                  </td>
                  <td>
                    <label for="stnd3">Nickname</label>
                    <span>
            <p *ngIf="(p.nickName==null)||(p.nickName=='')">-</p>
            <p *ngIf="p.nickName!=null">{{p.nickName}}</p>
            </span>
                  </td>
                  <td rowspan="2">
                    <button class="btn btn-primary pull-right " data-toggle="modal" data-target="#editParentModal" (click)="selectedParent = p;initEditParentForm()">Edit</button>
                  </td>
                </tr>
                <tr>
                  <td>
                    <label for="sname4">Contact Number</label>
                    <p>{{p.contactNo}}</p>
                  </td>
                  <td>
                    <label for="stnd4">Email ID</label>
                    <span>
            <p *ngIf="(p.email==null)||(p.email=='')">-</p>
            <p *ngIf="p.email!=null">{{p.email}}</p>
            </span>
                  </td>

                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>


      <div class="row" >
        <div style="position:relative;margin:auto;left:0;right:0;width:300px">
          <a (click)="addForm=1;initAddSiblingForm()" class="button" [ngClass]="{'selectedbtn': (addForm === 1) }"
            *ngIf="siblingLimit!=0">
              <span>Add Siblings</span>
            </a>

          <a (click)="addForm=2;initAddParentForm()" class="button" [ngClass]="{ 'selectedbtn': (addForm === 2) }" 
          *ngIf="parentLimit!=0">
            <span>Add Parents</span>
          </a>
        </div>
      </div>

      <!--Add Sibling Form-->

      <div style="border: 1px solid #dddddd;margin: 3% 1%;padding: 1%;border: 1px solid #dddddd;margin: 3% 1%;padding: 1%;" *ngIf="addForm === 1">
        <form [formGroup]="addSiblingForm" (submit)="submitSibling();addForm=null;">
          <br>
          <div class="form-group col-sm-12" formArrayName="students">
            <div class="row arrayRow" *ngFor="let stu of addSiblingForm.controls.students.controls; let i=index;" [formGroupName]="i">
              <div class="arrayForm">
                <div class="form-group col-sm-5">
                  <label for="sname5">Name</label>
                  <input type="text" id="sname" class="form-control" formControlName="name" placeholder="Enter Student's Name">
                  <div [hidden]="addSiblingForm.controls.students.controls[i].controls.name.valid || addSiblingForm.controls.students.controls[i].controls.name.untouched || addSiblingForm.controls.students.controls[i].controls.name.prestine" class="alert alert-warning">This field is required</div> 

                </div>
                <div class="form-group col-sm-5">
                  <label for="stnd5">Select Standard</label>
                  <select id="stnd" class="form-control" formControlName="standardId">
                        <option *ngFor="let s of standards" [value]="s.id">{{s.name}}</option>
                    </select>
                  <div [hidden]="addSiblingForm.controls.students.controls[i].controls.standardId.valid || addSiblingForm.controls.students.controls[i].controls.standardId.untouched" class="alert alert-warning">This field is required</div> 
                  
                </div>
                <div class="col-sm-2">
                  <button type="button" class="btn btn-primary active pull-right" (click)="removeSibling(addSiblingForm,i)">
                    <span class="glyphicon glyphicon-trash"></span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="row" style="margin:5% 5% 0% 5%;">
            <button type="submit" [disabled]="addSiblingForm.invalid" class="btn btn-success pull-right">Submit</button>
            <button type="button" [disabled]="((addSiblingForm.invalid)||(addSiblingForm.controls.students.length==5))" class="btn btn-primary active"
              (click)="addSibling(addSiblingForm);">
                Add Sibling
               </button>
          </div>
        </form>
      </div>

      <!--Add Parent Form-->
      <div style="border: 1px solid #dddddd;margin: 3% 1%;padding: 1%;" *ngIf="addForm === 2">

        <form [formGroup]="addParentForm" (submit)="submitParentForm();addForm=null;">

          <br>

          <div class="form-group col-sm-12">

            <!--
              <label for="stnd">Select Parent</label>
              <select id="stnd" class="form-control" [(ngModel)]="parent" [ngModelOptions]="{standalone: true}" (ngModelChange)="onParent($event,i)">
            <option *ngFor="let p of parents" [value]="p.name">{{p.name}}</option>
          </select>-->

            <div class="arrayForm">
              <div class="form-group col-sm-12">
                <label for="fname1">Parent's Name</label>
                <input type="text" id="fname1" class="form-control" placeholder="Enter Parent's Name" formControlName="name">
              <div class="alert alert-warning" [hidden]="addParentForm.controls.name.valid ||addParentForm.controls.name.untouched || addParentForm.controls.name.prestine">This field is required</div>
              </div>
              <div class="form-group col-sm-12">
                <label for="fname2">Parent's Nick Name</label>
                <input type="text" id="fname2" class="form-control" placeholder="Enter Parent's Nick Name" formControlName="nickName">
              </div>
              <div class="form-group col-sm-12">
                <label for="fname3">Parent's Contact Number</label>
                <input type="text" id="fname3" class="form-control" placeholder="Enter Parent's Contact Number" formControlName="contactNo">
              <div class="alert alert-warning" [hidden]="addParentForm.controls.contactNo.valid ||addParentForm.controls.contactNo.untouched || addParentForm.controls.contactNo.prestine">This field is required
                <div style="color:red">Contact No should be of 10 dogits</div>
              </div>              
              </div>
              <div class="form-group col-sm-12">
                <label for="fname4">Parent's Email ID</label>
                <input type="text" id="fname4" class="form-control" placeholder="Enter Parent's Email ID" formControlName="email">
                <div class="alert alert-warning" [hidden]="addParentForm.controls.email.valid ||addParentForm.controls.email.untouched || addParentForm.controls.email.prestine">This field is required
                <div style="color:red">Please enter valid email-address</div>
              </div>  
              </div>
            </div>

          </div>
          <div class="row" style="margin:5% 5% 0% 5%;">
            <button type="submit" [disabled]="addParentForm.invalid" class="btn btn-success pull-right">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>





<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">Student Updated</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        You have successfully updated the information.
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="errModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">Parent Already exists</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Parent is already added to our records.
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editSiblingModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">Edit Details</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form *ngIf="selectedSibling" [formGroup]="editStudentForm">
        <div class="modal-body">
          <label for="sname8">Name</label>
          <input type="text" id="sname8" class="form-control" formControlName="name">
          <label for="stnd8">Standard</label>
          <select id="stnd8" class="form-control" formControlName="standardId">
            <option *ngFor="let s of standards" [value]="s.id">{{s.name}}</option>
           </select>
        </div>
        <div class="modal-footer">
          <button class="btn btn-success pull-right" type="button" [disabled]="(!editStudentForm.dirty)||(editStudentForm.invalid)"
            (click)="submitEditStudentForm()" data-dismiss="modal">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="editParentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">Edit Details</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form [formGroup]="editParentForm" *ngIf="selectedParent">
        <div class="modal-body">
          <div class="form-group">
            <label for="sname9">Name</label>
            <input type="text" id="sname9" class="form-control" formControlName="name">
          </div>
          <div class="form-group">
            <label for="stnd8">Nick Name</label>
            <input type="text" id="stnd8" class="form-control" formControlName="nickName">
          </div>

          <div class="form-group">
            <label for="mail">Email</label>
            <input type="text" id="mail" class="form-control" formControlName="email">
            <div [hidden]="editParentForm.controls.email.valid||editParentForm.controls.email.untouched" class="alert alert-warning">Please enter a valid contact No</div>
            
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-success pull-right" type="button" [disabled]="(!editParentForm.dirty)||(editParentForm.invalid)" (click)="submitEditParentForm()"
            data-dismiss="modal">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="uploadStudentModal" role="dialog">
  <div class="modal-dialog">
    <!-- Update Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Update Profile Picture </h4>
      </div>
      <form [formGroup]="uploadPicForm">
        <div class="modal-body">
          <div class="row text-center">
            <loader [condition]="loader"></loader>
          </div>
          <div class="form-group">
            <input type="file" class="form-control-file" accept="image/*" id="exampleInputFile" aria-describedby="fileHelp" (change)="getFile($event)"
              formControlName='file'>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" (click)="uploadStudentImage()" class="btn btn-default" data-dismiss='modal'>Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>


<div class="modal fade" id="uploadParentModal" role="dialog">
  <div class="modal-dialog">
    <!-- Update Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Update Profile Picture </h4>
      </div>
      <form [formGroup]="uploadPicForm">
        <div class="modal-body">
          <div class="row text-center">
            <loader [condition]="loader"></loader>
          </div>
          <div class="form-group">
            <input type="file" class="form-control-file" accept="image/*" id="exampleInputFile" aria-describedby="fileHelp" (change)="getFile($event)"
              formControlName='file'>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" (click)="uploadParentImage()" class="btn btn-default" data-dismiss='modal'>Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">File Type Error</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Kindly upload an image file.
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>
</div>